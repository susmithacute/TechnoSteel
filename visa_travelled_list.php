<?php$page = "visa";$tab = "process_visa";$sub = "visa_tr_list";$head = $head1 = $sub1 = "";include('file_parts/header.php');$cmpArray = array();$today = date('Y-m-d');$nothing = "";$resFet = $db->selectQuery("SELECT sm_visa.visa_applicant_name, sm_visa_type.visa_type_name, sm_visa_category.visa_category, sm_visa.visa_expiry_date, sm_visa_renew.renew_id, sm_visa_renew.visa_balance_fee, sm_visa_renew.visa_id, sm_visa_renew.visa_renewal_date1, sm_visa.visa_number, sm_visa.visa_entry_date, sm_visa.visa_status, sm_visa_renew.visa_renewal_type, sm_visa_category.visa_category_type,sm_visa.visa_client_nameFROM sm_visa_renewINNER JOIN sm_visa ON sm_visa.visa_id = sm_visa_renew.visa_idINNER JOIN sm_visa_type ON sm_visa.visa_type = sm_visa_type.visa_type_idINNER JOIN sm_visa_category ON sm_visa_category.visa_category_id = sm_visa_renew.visa_renewal_typeWHERE sm_visa.visa_status =  'Entered'AND sm_visa_renew.renew_idIN (SELECT MAX( sm_visa_renew.renew_id )FROM sm_visa_renewGROUP BY sm_visa_renew.visa_id)");if (count($resFet)) {    $fees = "";    for ($rC = 0; $rC < count($resFet); $rC++) {        $visa_client_id = $resFet[$rC]['visa_client_name'];        $visa_client = $db->selectQuery("SELECT * FROM `sm_visa_client` WHERE `visa_client_id`='$visa_client_id'");        if (count($visa_client) > 0) {            $visa_client_name = $visa_client[0]['visa_client_name'];        }        if ($today > $resFet[$rC]['visa_renewal_date1']) {            $rnew_status = "Expired";        } else {            $rnew_status = $resFet[$rC]['visa_status'];        }        $values['visa_category_type'] = $resFet[$rC]['visa_category_type'];        $values['visa_id'] = $resFet[$rC]['visa_id'];        $values['visa_applicant_name'] = $resFet[$rC]['visa_applicant_name'];        $values['visa_client_name'] = $visa_client_name;        $values['visa_number'] = $resFet[$rC]['visa_number'];        $values['visa_type_name'] = $resFet[$rC]['visa_type_name'];        $values['visa_cat_type'] = $resFet[$rC]['visa_category'];        $values['visa_status'] = $rnew_status;        $values['visa_category'] = $resFet[$rC]['visa_renewal_type'];        //  $values['visa_mytype'] = $resFet[$rC]['visa_fee_id'];        $values['visa_balance_fee'] = $resFet[$rC]['visa_balance_fee'];        $entry = explode("-", $resFet[$rC]['visa_entry_date']);        $entry_date = $entry[2] . "/" . $entry[1] . "/" . $entry[0];        $values['visa_entry_date'] = $entry_date;        $expiry_date = explode("-", $resFet[$rC]['visa_renewal_date1']);        $exp = $expiry_date[2] . "" . $expiry_date[1] . "" . $expiry_date[0];        $values['visa_exp'] = $exp;        $cmpArray["data"][] = $values;    }}$fp = fopen('assets/extras/visa_travelled.json', 'w');fwrite($fp, json_encode($cmpArray));fclose($fp);?><style>    .validate_span {        color: #ff7b76 !important;        font-size: 12px;        line-height: 0.9em;        list-style-type: none;    }</style><section id="content">    <div class="page page-shop-products">        <div class="pageheader">            <h2>Entered List <span></span></h2>            <div class="page-bar">                <ul class="page-breadcrumb">                    <li>                        <a><i class="fa fa-home"></i> SME</a>                    </li>                    <li>                        <a href="#">Visa</a>                    </li>                    <li>                        <a href="#">Expired</a>                    </li>                    <li>                        <a href="#">Entered List</a>                    </li>                </ul>            </div>        </div>        <!-- page content -->        <div class="pagecontent">            <!-- row -->            <div class="row">                <!-- col -->                <div class="col-md-12">                    <section class="tile">                        <!-- tile header -->                        <div class="tile-header dvd dvd-btm">                            <h1 class="custom-font"><strong>Entered</strong> List</h1>                            <ul class="controls">                                <!--<li><a href="javascipt:;"><i class="fa fa-plus mr-5"></i> New Company</a></li>-->                                <li class="dropdown">                                    <a role="button" tabindex="0" class="dropdown-toggle settings" data-toggle="dropdown">                                        <i class="fa fa-cog"></i>                                        <i class="fa fa-spinner fa-spin"></i>                                    </a>                                    <ul class="dropdown-menu pull-right with-arrow animated littleFadeInUp">                                        <li>                                            <a role="button" tabindex="0" class="tile-toggle">                                                <span class="minimize"><i class="fa fa-angle-down"></i>&nbsp;&nbsp;&nbsp;Minimize</span>                                                <span class="expand"><i class="fa fa-angle-up"></i>&nbsp;&nbsp;&nbsp;Expand</span>                                            </a>                                        </li>                                        <li>                                            <a role="button" tabindex="0" class="tile-refresh">                                                <i class="fa fa-refresh"></i> Refresh                                            </a>                                        </li>                                        <li>                                            <a role="button" tabindex="0" class="tile-fullscreen">                                                <i class="fa fa-expand"></i> Fullscreen                                            </a>                                        </li>                                    </ul>                                </li>                                <li class="remove"><a role="button" tabindex="0" class="tile-close"><i class="fa fa-times"></i></a></li>                            </ul>                        </div>                        <!-- /tile header -->                        <!-- tile body -->                        <div class="tile-body">                            <div class="table-responsive">                                <table class="table table-striped table-hover table-custom" id="products-list">                                    <thead>                                        <tr>                                            <th>Sl No.</th>                                            <th style="width:120px;">Applicant Name</th>                                            <th>Client Name</th>                                            <th>Visa Number</th>                                            <th>Visa Type</th>                                            <th>Visa Category</th>                                            <th>Entry Date</th>                                            <th>Expiry Date</th>                                            <th>Status</th>                                            <th>Actions</th>                                        </tr>                                    </thead>                                </table>                            </div>                        </div>                        <!-- /tile body -->                    </section>                    <!-- /tile -->                </div>                <!-- /col -->            </div>            <!-- /row -->        </div>        <!-- /page content -->    </div></section><div class="modal splash fade" id="splash" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">    <div class="modal-dialog">        <div class="modal-content">            <div class="modal-header">                <h3 class="modal-title custom-font">Visa Renewal</h3>            </div>            <input type="hidden" id="renew_visa_id" value=""/>            <input type="hidden" class="form-control" name="renew_exdate" id="renew_exdate" />            <div class="modal-body">                <input type="hidden" class="form-control" name="mytype" id="renew_mytype" />                <div class="row">                    <div class="col-md-6">                        <label class="form-label">Renewal Type</label>                        <!--<input type="text" class="form-control" name="renew_type" id="renew_type"/>-->                        <select class="form-control" name="renew_type" id="renew_type">                        </select>                        <span id="renew_span"></span>                    </div>                    <div class="col-md-6">                        <label class="form-label">Balance Pending</label>                        <input type="text" class="form-control" name="balance_pending" id="balance_pending" readonly value=""  />                    </div>                </div>                <div class="row">                    <div class="col-md-6">                        <label class="form-label">Bank Fee</label>                        <input type="text" class="form-control" name="bank_fee" id="bank_fee" />                    </div>                    <div class="col-md-6">                        <label class="form-label">Company Fee</label>                        <input type="text" class="form-control" name="company_fee" id="company_fee" />                    </div>                </div>                <div class="row">                    <div class="col-md-6">                        <label class="form-label">Sponsor Fee</label>                        <input type="text" class="form-control" name="sponsor_fee" id="sponsor_fee" />                    </div>                    <div class="col-md-6">                        <label class="form-label">Total Fee</label>                        <input type="text" class="form-control" name="total_fee" readonly="" id="total_fee" />                    </div>                </div>                <div class="row">                    <div class="col-md-6">                        <label class="form-label">Advance Fee</label>                        <input type="text" class="form-control" name="advance_fee" id="advance_fee" />                        <span id="fee_warning"></span>                    </div>                    <div class="col-md-6">                        <label class="form-label">Balance Fee</label>                        <input type="text" class="form-control" readonly="" name="balance_fee" id="balance_fee" />                        <!--<span class="validate_span">*Pending balance will be added here</span>-->                    </div>                </div>                <div class="row">                    <div class="col-md-12">                        <label class="form-label">Renewal Date</label>                        <input type="text" class="form-control" name="renew_date" id="renew_date" />                    </div>                </div>                <span class="validate_span" id="renew_check"></span>            </div>            <div class="modal-footer">                <button class="btn btn-default btn-border" id="renew_btn">Renew</button>                <button class="btn btn-default btn-border" data-dismiss="modal">Cancel</button>            </div>        </div>    </div></div><!--/ CONTENT --></div><!--/ Application Content --><!-- ========================================================== Vendor JavaScripts ============================================================ --><script src="assets/jquery.min.js"></script><script>window.jQuery || document.write('<script src="assets/js/vendor/jquery/jquery-1.11.2.min.js"><\/script>')</script><script src="assets/js/vendor/bootstrap/bootstrap.min.js"></script><script src="assets/js/vendor/jRespond/jRespond.min.js"></script><script src="assets/js/vendor/sparkline/jquery.sparkline.min.js"></script><script src="assets/js/vendor/slimscroll/jquery.slimscroll.min.js"></script><script src="assets/js/vendor/animsition/js/jquery.animsition.min.js"></script><script src="assets/js/vendor/screenfull/screenfull.min.js"></script><script src="assets/js/vendor/datatables/js/jquery.dataTables.min.js"></script><script src="assets/js/vendor/datatables/extensions/dataTables.bootstrap.js"></script><script src="assets/js/vendor/datatables/extensions/Pagination/input.js"></script><script src="assets/js/vendor/date-format/jquery-dateFormat.min.js"></script><!--/ vendor javascripts --><!-- ========================================================== Custom JavaScripts ============================================================ --><script src="assets/js/main.js"></script><script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script><link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css"><!--/ custom javascripts --><!-- ============================================================= Page Specific Scripts =============================================================== --><script>    $('#renew_date').datepicker({dateFormat: 'dd-mm-yy', changeMonth: true, changeYear: true});</script><script>    $('#renew2_date').datepicker({dateFormat: 'dd-mm-yy', changeMonth: true, changeYear: true});</script><script>    $(window).load(function () {        var t = $('#products-list').DataTable({            "dom": '<"row"<"col-md-8 col-sm-12"<"inline-controls"l>><"col-md-4 col-sm-12"<"pull-right"f>>>t<"row"<"col-md-4 col-sm-12"<"inline-controls"l>><"col-md-4 col-sm-12"<"inline-controls text-center"i>><"col-md-4 col-sm-12"p>>',            "language": {                "sLengthMenu": 'View _MENU_ records',                "sInfo": 'Found _TOTAL_ records',                "oPaginate": {                    "sPage": "Page ",                    "sPageOf": "of",                    "sNext": '<i class="fa fa-angle-right"></i>',                    "sPrevious": '<i class="fa fa-angle-left"></i>'                }            },            "pagingType": "input",            "ajax": 'assets/extras/visa_travelled.json',            "order": [[1, "desc"]],            "columns": [                {"data": null},                {"type": "html",                    "data": "visa_applicant_name",                    "render": function (data, type, full, meta) {                        return '<a href="visa_process.php?visa_id=' + full.visa_id + '" class=""><i class=""></i> ' + data + '</a>';                    }},                {"data": "visa_client_name"},                {"data": "visa_number"},                {"data": "visa_type_name"},                {"data": "visa_cat_type"},                {"data": "visa_entry_date"},                {                    "type": "html",                    "data": "visa_exp",                    "render": function (data, type, full, meta) {                        //    var dateSplit = data.split('-');                        var v1 = data.substring(0, 2);                        var v2 = data.substring(2, 4);                        var v3 = data.substring(4, 8);                        //    var date_var = dateSplit[2] + '-' + dateSplit[1] + '-' + dateSplit[0];                        return v1 + '/' + v2 + '/' + v3;                    }},                {"data": "visa_status"},                {                    "type": "html",                    "data": "visa_category",                    "render": function (data, type, full, meta) {                        var date_visa = "";                        var exps_date = full.visa_exp;                        var find_len = exps_date.length;                        if (find_len != 8) {                            date_visa = "0" + exps_date;                        } else {                            date_visa = exps_date;                        }                        if (full.visa_type === 'Tourist Visa' || full.visa_type === 'Visiting Visa') {                            return '<span class="label bg-warning"></span>';                        } else                        {                            var vd1 = date_visa.substring(0, 2);                            var vd2 = date_visa.substring(2, 4);                            var vd3 = date_visa.substring(4, 8);                            var exp_date = vd1 + vd2 + vd3;                            return '<a onclick="delete_id(' + exp_date + ',' + full.visa_id + ',' + full.visa_balance_fee + ',' + full.visa_category_type + ')" class="btn btn-xs btn-default mr-5" data-toggle="modal" data-target="#splash" data-options="splash-ef-3"><i class="fa fa-plus"></i> Renew</a>';                        }                    }                }            ],            "aoColumnDefs": [                {'bSortable': true, 'aTargets': 0}            ],            "aLengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],            "drawCallback": function (settings, json) {                $(".formatDate").each(function (idx, elem) {                    $(elem).text($.format.date($(elem).text(), "MMM d, yyyy"));                });                $('#select-all').change(function () {                    if ($(this).is(":checked")) {                        $('#products-list tbody .selectMe').prop('checked', true);                    } else {                        $('#products-list tbody .selectMe').prop('checked', false);                    }                });            }        });        t.on('order.dt search.dt', function () {            t.column(0, {search: 'applied', order: 'applied'}).nodes().each(function (cell, i) {                cell.innerHTML = i + 1;            });        }).draw();        //*initialize datatable    });    $('#bank_fee').keyup(function () {        $('#total_fee').val(calculate_fee());    });    $('#sponsor_fee').keyup(function () {        $('#total_fee').val(calculate_fee());    });    $('#company_fee').keyup(function () {        $('#total_fee').val(calculate_fee());    });    function calculate_fee() {        var bank = $('#bank_fee').val();        if (bank === "") {            bank = 0;        }        var sponsor = $('#sponsor_fee').val();        if (sponsor === "") {            sponsor = 0;        }        var company = $('#company_fee').val();        if (company === "") {            company = 0;        }        var total_fee = 0;        return total_fee = parseInt(bank) + parseInt(sponsor) + parseInt(company);    }    $('#advance_fee').on('keyup', function (e) {        var pending_bal = $('#balance_pending').val();        var visa_advance = $('#advance_fee').val();        var total_fee = $('#total_fee').val();        var check_bal = parseInt(pending_bal) + parseInt(total_fee);        if (parseInt(visa_advance) > parseInt(check_bal)) {            $('#fee_warning').html("Advance is greater than total amount!");            $('#advance_fee').val("");            $('#balance_fee').val("");        } else {            $('#fee_warning').html("");            if (visa_advance === "") {                visa_advance = 0;            }            if (pending_bal === "") {                pending_bal = 0;            }            var visa_balance1 = parseInt(total_fee) - parseInt(visa_advance);            var visa_balance = parseInt(visa_balance1);            $('#balance_fee').val(visa_balance);        }    });    $('#bank_fee2').keyup(function () {        $('#total_fee2').val(calculate_fee2());    });    $('#sponsor_fee2').keyup(function () {        $('#total_fee2').val(calculate_fee2());    });    $('#company_fee2').keyup(function () {        $('#total_fee2').val(calculate_fee2());    });    function calculate_fee2() {        var bank2 = $('#bank_fee2').val();        if (bank2 === "") {            bank2 = 0;        }        var sponsor2 = $('#sponsor_fee2').val();        if (sponsor2 === "") {            sponsor2 = 0;        }        var company2 = $('#company_fee2').val();        if (company2 === "") {            company2 = 0;        }        var total_fee2 = 0;        return total_fee2 = parseInt(bank2) + parseInt(sponsor2) + parseInt(company2);    }    $('#advance_fee2').on('keyup', function (e) {        var pending_bal2 = $('#balance_pending2').val();        var visa_advance2 = $('#advance_fee2').val();        var total_fee2 = $('#total_fee2').val();        var check_bal2 = parseInt(pending_bal2) + parseInt(total_fee2);        if (parseInt(visa_advance2) > parseInt(check_bal2)) {            $('#fee_warning2').html("Advance is greater than total amount!");            $('#advance_fee2').val("");            $('#balance_fee2').val("");        } else {            $('#fee_warning2').html("");            if (visa_advance2 === "") {                visa_advance2 = 0;            }            if (pending_bal2 === "") {                pending_bal2 = 0;            }            var visa_balance12 = parseInt(total_fee2) - parseInt(visa_advance2);            var visa_balance2 = parseInt(visa_balance12);            $('#balance_fee2').val(visa_balance2);        }    });</script><!--/ Page Specific Scripts --><script type="text/javascript">    function delete_id(vrd1, id1, fee1, cat_type)    {        $.ajax({            url: "visa_renew1_ajax.php",            type: "POST",            data: {cat_type: cat_type, vd: id1},            success: function (data) {                $('#renew_type').html(data);            }        });        $('#renew_visa_id').val(id1);        $('#balance_pending').val(fee1);        $('#balance_fee').val(fee1);        $('#renew_exdate').val(vrd1);        //$('#emp_count').html(emp_count);    }//    $(document).on('change', '#renew_type_selected', function () {////    });    $('#renew_btn').click(function () {        var error_check = 0;        var visa_id = $('#renew_visa_id').val();        var renew_type = $('#renew_type').val();        var renew_fee = $('#renew_fee').val();        var renew_date = $('#renew_date').val();        var renew_exdate = $('#renew_exdate').val();        var bank_fee = $('#bank_fee').val();        var company_fee = $('#company_fee').val();        var sponsor_fee = $('#sponsor_fee').val();        var total_fee = $('#total_fee').val();        var balance_fee = $('#balance_fee').val();        var advance_fee = $('#advance_fee').val();        if (renew_type === "") {            error_check = 1;        }        if (error_check === 0) {            $.ajax({                url: "visa_renew1_ajax.php",                type: "POST",                data: {advance_fee: advance_fee, total_fee: total_fee, balance_fee: balance_fee, bank_fee: bank_fee, company_fee: company_fee, sponsor_fee: sponsor_fee, visa_id: visa_id, renew_type: renew_type, renew_fee: renew_fee, renew_date: renew_date, renew_exdate: renew_exdate},                success: function (data) {                    window.location = "visa_travelled_list.php";                }            });        } else {            $('#renew_check').html("Renewal Type Cannot be Empty!");        }    });</script></body></html>